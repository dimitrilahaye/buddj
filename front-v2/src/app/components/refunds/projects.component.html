<app-header-back-button></app-header-back-button>
<div class="content">
  @if(!hasProjects()) {
  <app-tips>
    <p>{{ tipsLabel }}</p>
    <img width="50%" [src]="tipsImage" alt="" />
  </app-tips>
  } @else {
  <ng-container *ngFor="let project of projects()">
    <app-card>
      <div class="project">
        <div class="project__header">
          <span class="project-header__name">{{ project.name }}</span>
          <span class="project-header__actions">
            <!-- roll back -->
            <app-button-icon
              icon="fa-arrow-rotate-left"
              size="small"
              [disabled]="!project.canRollback"
            ></app-button-icon>
            <!-- re-apply -->
            <app-button-icon
              icon="fa-arrow-rotate-right"
              size="small"
              [disabled]="!project.canReApply"
            ></app-button-icon>
            <!-- add amount -->
            <app-button-icon
              icon="fa-plus"
              size="small"
              [loading]="isLoading"
            ></app-button-icon>
            <!-- edit project -->
            <app-button-icon
              icon="fa-edit"
              size="small"
              (click)="openEditModal(project)"
            ></app-button-icon>
            <!-- remove project -->
            <app-button-icon
              icon="fa-trash-can"
              size="small"
              [loading]="isLoading"
            ></app-button-icon>
            <!-- finish project -->
            <app-button-icon
              icon="fa-flag-checkered"
              size="small"
              [disabled]="!project.canFinish"
            ></app-button-icon>
          </span>
        </div>
        <div class="project__info">
          <span class="project-info__label">{{ loaderLabel }}</span>
          <app-progress-bar
            [currentValue]="project.leftAmount"
            [total]="project.target"
          ></app-progress-bar>
        </div>
      </div>
    </app-card>
  </ng-container>
  }
  <button class="add-project" (click)="openCreateModal()">
    <i class="fa-solid fa-plus"></i>
  </button>
</div>

<!-- creation modal -->
@if (slidingModalIsOpen('creation')) {
<app-sliding-modal
  [isOpen]="slidingModalIsOpen('creation')"
  (close)="closeSlidingModal($event, 'creation')"
>
  <div class="modal-container">
    <!-- project name -->
    <input
      class="input"
      type="text"
      [value]="creatingProject()?.name"
      (input)="updateCreatingProjectName($event)"
      [required]="true"
      placeholder="Nom"
    />
    <!-- project target -->
    <input
      class="input"
      type="number"
      step="0.01"
      [required]="true"
      [value]="creatingProject()?.target"
      (click)="openSlidingModal('numpad')"
      inputmode="none"
      autocomplete="off"
      readonly
    />

    <app-button
      [variant]="'danger'"
      [label]="createButtonLabel"
      [loading]="isLoading"
      (click)="createProject($event)"
    ></app-button>
  </div>
</app-sliding-modal>
}
<!-- update modal -->
@if (slidingModalIsOpen('update')) {
<app-sliding-modal
  [isOpen]="slidingModalIsOpen('update')"
  (close)="closeSlidingModal($event, 'update')"
>
  <div class="modal-container">
    <!-- project name -->
    <input
      class="input"
      type="text"
      [value]="updatingProject()?.name"
      (input)="updateUpdatingProjectName($event)"
      [required]="true"
      placeholder="Nom"
    />
    <!-- project target -->
    <input
      class="input"
      type="number"
      step="0.01"
      [required]="true"
      [value]="updatingProject()?.target"
      (click)="openSlidingModal('numpad')"
      inputmode="none"
      autocomplete="off"
      readonly
    />

    <app-button
      [variant]="'danger'"
      [label]="updateButtonLabel"
      [loading]="isLoading"
      (click)="updateProject($event)"
    ></app-button>
  </div>
</app-sliding-modal>
}
<!-- create numpad -->
@if(slidingModalIsOpen('numpad')) {
<app-sliding-modal
  [isOpen]="slidingModalIsOpen('numpad')"
  (close)="closeSlidingModal($event, 'numpad')"
>
  <app-numpad
    [value]="creatingProject()?.target?.toString() ?? '0'"
    (submitted)="updateCreatingProjectTarget($event)"
  ></app-numpad>
</app-sliding-modal>
}
<!-- update numpad -->
@if(slidingModalIsOpen('numpad')) {
<app-sliding-modal
  [isOpen]="slidingModalIsOpen('numpad')"
  (close)="closeSlidingModal($event, 'numpad')"
>
  <app-numpad
    [value]="updatingProject()?.target?.toString() ?? '0'"
    (submitted)="updateUpdatingProjectTarget($event)"
  ></app-numpad>
</app-sliding-modal>
}
