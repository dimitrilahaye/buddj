<div class="outflows">
  @if(outflowsFormArray.controls.length) {
  <form [formGroup]="form" (ngSubmit)="onSubmit()">
    <div class="outflows-list" formArrayName="outflows">
      <app-item
        *ngFor="let outflow of outflowsFormArray.controls; let i = index"
        [formGroupName]="i"
      >
        <button
          type="button"
          [ngClass]="{
            'outflows-list-item--checked': isOutflowItemChecked(i)
          }"
          class="outflows-list-item"
          (click)="toggleOutflowAtIndex(i, $event)"
        >
          <span class="outflows-list-item__icon">
            <i class="fa-solid fa-money-bill-transfer"></i>
          </span>
          <div
            [ngClass]="{
              'outflows-list-item__info--checked': isOutflowItemChecked(i)
            }"
            class="outflows-list-item__info"
          >
            <span class="outflows-list-item-info__label">{{
              outflow.get("label")?.value || "Label introuvable"
            }}</span>
            <span class="outflows-list-item-info__amount"
              >{{ outflow.get("amount")?.value || "Somme introuvable" }}â‚¬</span
            >
          </div>

          <button
            class="outflows-list-item__delete"
            type="button"
            [disabled]="outflowDeletionIsLoadingByIndex(i)"
            (click)="deleteOutflowByIndex(i, $event)"
          >
            @if(outflowDeletionIsLoadingByIndex(i)) {
            <ng-container *ngTemplateOutlet="loader"></ng-container>
            } @else {
            <i class="fa-solid fa-trash-can"></i>
            }
          </button>
        </button>
      </app-item>
    </div>
  </form>
  }
</div>

<ng-template #loader>
  <span class="outflows-list-item-delete__loader">
    <svg
      width="20"
      height="20"
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
    >
      <style>
        .spinner_mHwL {
          animation: spinner_OeFQ 0.75s cubic-bezier(0.56, 0.52, 0.17, 0.98)
            infinite;
          fill: currentColor;
        }
        .spinner_ote2 {
          animation: spinner_ZEPt 0.75s cubic-bezier(0.56, 0.52, 0.17, 0.98)
            infinite;
          fill: currentColor;
        }
        @keyframes spinner_OeFQ {
          0% {
            cx: 4px;
            r: 3px;
          }
          50% {
            cx: 9px;
            r: 8px;
          }
        }
        @keyframes spinner_ZEPt {
          0% {
            cx: 15px;
            r: 8px;
          }
          50% {
            cx: 20px;
            r: 3px;
          }
        }
      </style>
      <defs>
        <filter id="spinner-gF00">
          <feGaussianBlur in="SourceGraphic" stdDeviation="1.5" result="y" />
          <feColorMatrix
            in="y"
            mode="matrix"
            values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 18 -7"
            result="z"
          />
          <feBlend in="SourceGraphic" in2="z" />
        </filter>
      </defs>
      <g filter="url(#spinner-gF00)">
        <circle class="spinner_mHwL" cx="4" cy="12" r="3" />
        <circle class="spinner_ote2" cx="15" cy="12" r="8" />
      </g>
    </svg>
  </span>
</ng-template>
