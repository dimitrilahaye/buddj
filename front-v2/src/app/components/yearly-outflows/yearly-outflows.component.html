<app-modal
  [modalOpen]="outflowDelationModalIsOpen"
  (click)="closeOutflowDelationModal($event)"
>
  <app-button
    [size]="'big'"
    [variant]="'danger'"
    [label]="'Supprimer la sortie dÃ©finitivement'"
    [loading]="removeIsLoading"
    (click)="removeOutflow($event)"
  ></app-button>
</app-modal>

<app-header-back-button></app-header-back-button>
<div class="content">
  @if(!savings()) {
  <app-tips>
    <p>Vous n'avez pas encore crÃ©e de sorties annuelles ðŸ™‚</p>
    <img width="70%" src="info/no-yearly-outflows-yet.png" alt="" />
  </app-tips>
  } @else {
  <ng-container *ngFor="let month of months">
    <section class="outflows__month">
      <div class="outflows-month__title">
        {{ month.label }}
      </div>
      <div class="outflows__list">
        <div class="outflows-list__header">
          <div class="subtitle">Sorties</div>
          <app-button-icon
            icon="fa-plus"
            size="small"
            (click)="addOutflowToMonth(month.month, $event)"
          ></app-button-icon>
        </div>
        @if (getOutflowsForMonth(month.month).length === 0) {
        <app-tips>
          <p>Vous n'avez enregistrÃ© aucune sortie pour ce mois ðŸ™‚</p>
          <img width="70%" src="info/no-yearly-outflows-yet.png" alt="" />
        </app-tips>
        } @else {
        <div class="outflows-list__list">
          <app-item
            *ngFor="
              let outflow of getOutflowsForMonth(month.month);
              let i = index
            "
          >
            <button type="button" class="outflows-list-item">
              <span class="outflows-list-item__icon">
                <i class="fa-solid fa-money-bill-transfer"></i>
              </span>
              <div class="outflows-list-item__info">
                <span class="outflows-list-item-info__label">
                  {{ outflow.label }}</span
                >
                <span class="outflows-list-item-info__amount">{{
                  outflow.amount | currency : "EUR"
                }}</span>
              </div>

              <button
                class="outflows-list-item__delete"
                type="button"
                (click)="openOutflowDelationModal(outflow, $event)"
              >
                <i class="fa-solid fa-trash-can"></i>
              </button>
            </button>
          </app-item>
        </div>
        }
        <div class="outflows-list__header">
          <div class="subtitle">Budgets</div>
          <app-button-icon
            icon="fa-plus"
            size="small"
            (click)="addBudgetToMonth(month.month, $event)"
          ></app-button-icon>
        </div>
        @if (getBudgetsForMonth(month.month).length === 0) {
        <app-tips>
          <p>Vous n'avez enregistrÃ© aucun budget pour ce mois ðŸ™‚</p>
          <img width="70%" src="info/no-yearly-outflows-yet.png" alt="" />
        </app-tips>
        } @else {
        <div class="outflows-list__list">
          <app-item
            *ngFor="
              let budget of getBudgetsForMonth(month.month);
              let i = index
            "
          >
            <button type="button" class="outflows-list-item">
              <span class="outflows-list-item__icon">
                <i class="fa-solid fa-basket-shopping"></i>
              </span>
              <div class="outflows-list-item__info">
                <span class="outflows-list-item-info__label">
                  {{ budget.name }}</span
                >
                <span class="outflows-list-item-info__amount">{{
                  budget.initialBalance | currency : "EUR"
                }}</span>
              </div>

              <button
                class="outflows-list-item__delete"
                type="button"
                (click)="openBudgetDelationModal(budget, $event)"
              >
                <i class="fa-solid fa-trash-can"></i>
              </button>
            </button>
          </app-item>
        </div>
        }
      </div>
    </section>
    <app-divider></app-divider>
  </ng-container>
  }
</div>

<div class="month-creation__footer">
  <div class="month-creation-footer__actions">
    <span class="month-creation-footer__forecast-balance"
      >Total par mois :
      <strong>{{ totalAmountByMonth | currency : "EUR" }}</strong></span
    >
  </div>
</div>

<!-- 
  ##################### ADD YEARLY OUTFLOW #####################
   -->
@if(addOutflowForm) {
<app-sliding-modal
  [isOpen]="isOutflowsModalOpen"
  [canClose]="!addOutflowFormIsLoading"
  (close)="closeOutflowsModal()"
>
  <form [formGroup]="addOutflowForm" (ngSubmit)="submitOutflowModal($event)">
    <div class="modal-container">
      <!-- label -->
      <app-input-text
        [formGroup]="addOutflowForm"
        formControlName="label"
        [required]="true"
        [placeholder]="'LibellÃ©'"
      ></app-input-text>

      <!-- amount -->
      <app-input-number
        (click)="openOutflowNumpad(addOutflowForm.controls['amount'], $event)"
        [formGroup]="addOutflowForm"
        formControlName="amount"
        [required]="true"
        [step]="'0.01'"
        [placeholder]="'Montant'"
      ></app-input-number>

      <div class="modal-container__actions">
        <app-button
          class="login-page__login-button"
          [type]="'submit'"
          [variant]="'danger'"
          [label]="'Ajouter cette sortie annuelle'"
          [loading]="addOutflowFormIsLoading"
          (click)="submitOutflowModal($event)"
        ></app-button>
      </div>
    </div>
  </form>
</app-sliding-modal>
}
<!-- NUMPAD FOR OUTFLOW -->
@if(amountValueControl !== null) {
<app-sliding-modal
  [isOpen]="isOutflowNumpadModalOpen"
  (close)="closeOutflowNumpad($event)"
>
  <app-numpad
    [value]="amountValue"
    (submitted)="updateAmountValue($event)"
  ></app-numpad>
</app-sliding-modal>
}
<!-- 
  ##################### ADD YEARLY BUDGET #####################
   -->
@if(addBudgetForm) {
<app-sliding-modal
  [isOpen]="isBudgetsModalOpen"
  [canClose]="!addBudgetFormIsLoading"
  (close)="closeBudgetsModal()"
>
  <form [formGroup]="addBudgetForm" (ngSubmit)="submitBudgetModal($event)">
    <div class="modal-container">
      <!-- name -->
      <app-input-text
        [formGroup]="addBudgetForm"
        formControlName="name"
        [required]="true"
        [placeholder]="'Nom'"
      ></app-input-text>

      <!-- amount -->
      <app-input-number
        (click)="
          openBudgetNumpad(addBudgetForm.controls['initialBalance'], $event)
        "
        [formGroup]="addBudgetForm"
        formControlName="initialBalance"
        [required]="true"
        [step]="'0.01'"
        [placeholder]="'Solde initial'"
      ></app-input-number>

      <div class="modal-container__actions">
        <app-button
          class="login-page__login-button"
          [type]="'submit'"
          [variant]="'danger'"
          [label]="'Ajouter ce budget annuel'"
          [loading]="addBudgetFormIsLoading"
          (click)="submitBudgetModal($event)"
        ></app-button>
      </div>
    </div>
  </form>
</app-sliding-modal>
}
<!-- NUMPAD FOR BUDGET -->
@if(initialBalanceValueControl !== null) {
<app-sliding-modal
  [isOpen]="isBudgetNumpadModalOpen"
  (close)="closeBudgetNumpad($event)"
>
  <app-numpad
    [value]="initialBalanceValue"
    (submitted)="updateInitialBalanceValue($event)"
  ></app-numpad>
</app-sliding-modal>
}
